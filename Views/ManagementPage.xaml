<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkTimeTracker.ViewModels"
             xmlns:models="clr-namespace:WorkTimeTracker.Models"
             x:Class="WorkTimeTracker.Views.ManagementPage"
             x:DataType="vm:ManagementPageViewModel"
             Title="Gestão"
             BackgroundColor="White">

    <VerticalStackLayout Padding="10"
                         Spacing="12">

        <!-- Mês atual -->
        <Label Text="{Binding CurrentMonth, StringFormat='MMMM yyyy'}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center" />

        <!-- Calendário centrado -->
        <Grid HorizontalOptions="Center">
            <CollectionView x:Name="CalendarCollectionView"
                            WidthRequest="350"
                            ItemsSource="{Binding Days}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedDay, Mode=TwoWay}">

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="7" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:CalendarDay">

                        <Border Padding="6"
                                Margin="2"
                                Stroke="{Binding HasSessions, Converter={StaticResource BoolToColorConverter}}"
                                Background="{Binding HasSessions, Converter={StaticResource BoolToBackgroundConverter}}"
                                StrokeShape="RoundRectangle 6">

                            <VerticalStackLayout Spacing="2"
                                                 HorizontalOptions="Center"
                                                 VerticalOptions="Center">

                                <!-- Dia -->
                                <Label Text="{Binding Date.Day}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center" />

                                <!-- Total do dia (opcional, aparece só se houver sessões) -->
                                <Label Text="{Binding TotalValue, StringFormat='€ {0:F2}'}"
                                       FontSize="10"
                                       IsVisible="{Binding HasSessions}"
                                       HorizontalOptions="Center" />

                            </VerticalStackLayout>

                        </Border>

                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </Grid>

        <!-- Botão resumo do mês -->
        <Button Text="Ver resumo do mês"
                Command="{Binding ShowMonthSummaryCommand}"
                HorizontalOptions="Center"
                Margin="0,10,0,0" />

    </VerticalStackLayout>

</ContentPage>